<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ú® Relay - Chat</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ==================== -->
    <!-- CHAT HEADER SECTION  -->
    <!-- ==================== -->
    <header class="chat-header">
        <button class="back-btn" onclick="goBack()">‚Üê</button>
        <div class="chat-user-info">
            <div class="chat-user-avatar" id="chatUserAvatar">F</div>
            <div class="chat-user-details">
                <h3 id="chatUserName">Friend Name</h3>
                <div class="chat-user-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">Online</span>
                </div>
            </div>
        </div>
        <div class="chat-actions">
            <button class="chat-action-btn" onclick="showUserInfo()" title="User Info">‚ìò</button>
            <button class="chat-action-btn" onclick="clearChatPrompt()" title="Clear Chat">üóëÔ∏è</button>
        </div>
    </header>

    <!-- ==================== -->
    <!-- MAIN CONTENT SECTION -->
    <!-- ==================== -->
    <main class="main-content" id="mainContent">
        <div class="messages-container" id="messagesContainer">
            <!-- Messages loaded by JavaScript -->
        </div>
    </main>

    <!-- ==================== -->
    <!-- COLOR PICKER WILL BE INJECTED HERE -->
    <!-- ==================== -->

    <!-- ==================== -->
    <!-- IMAGE PICKER OVERLAY -->
    <!-- ==================== -->
    <div class="image-picker-overlay" id="imagePickerOverlay">
        <div class="image-picker-container">
            <div class="image-picker-header">
                <h3>Choose Image</h3>
                <button class="image-picker-close" onclick="closeImagePicker()">√ó</button>
            </div>
            <div class="image-picker-options">
                <button class="image-picker-option" onclick="openCamera()">
                    <svg class="picker-icon" viewBox="0 0 24 24">
                        <path d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"/>
                    </svg>
                    <span>Camera</span>
                </button>
                <button class="image-picker-option" onclick="openGallery()">
                    <svg class="picker-icon" viewBox="0 0 24 24">
                        <path d="M22,16V4A2,2 0 0,0 20,2H8A2,2 0 0,0 6,4V16A2,2 0 0,0 8,18H20A2,2 0 0,0 22,16M11,12L13.03,14.71L16,11L20,16H8M2,6V20A2,2 0 0,0 4,22H18V20H4V6"/>
                    </svg>
                    <span>Gallery</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== -->
    <!-- MESSAGE INPUT        -->
    <!-- ==================== -->
    <div class="message-input-wrapper" id="messageInputWrapper">
        <div class="message-input-container">
            <button class="attach-btn" id="attachBtn" onclick="showImagePicker()" title="Attach Image">
                <svg class="attach-icon" viewBox="0 0 24 24">
                    <path d="M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"/>
                </svg>
            </button>
            
            <textarea class="message-input" id="messageInput" 
                      placeholder="Type a message..." 
                      rows="1"
                      onkeydown="handleKeyPress(event)"
                      oninput="autoResize(this)"></textarea>
            
            <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
                <svg class="send-icon" viewBox="0 0 24 24">
                    <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
    <input type="file" id="galleryInput" accept="image/*" multiple style="display: none;">

    <!-- ==================== -->
    <!-- ALERT SYSTEM         -->
    <!-- ==================== -->
    <div class="custom-alert-overlay" id="customAlert" style="display: none;">
        <div class="custom-alert">
            <div class="custom-alert-icon" id="alertIcon">‚ö†Ô∏è</div>
            <h3 class="custom-alert-title" id="alertTitle"></h3>
            <p class="custom-alert-message" id="alertMessage"></p>
            <div class="custom-alert-buttons">
                <button class="alert-btn confirm" id="alertConfirm">OK</button>
                <button class="alert-btn cancel" id="alertCancel" style="display: none;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ==================== -->
    <!-- TOAST NOTIFICATION   -->
    <!-- ==================== -->
    <div class="custom-toast" id="customToast" style="display: none;">
        <span class="toast-icon" id="toastIcon">‚ÑπÔ∏è</span>
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- ==================== -->
    <!-- USER INFO MODAL      -->
    <!-- ==================== -->
    <div class="modal-overlay" id="userInfoModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">User Info</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div id="userInfoContent"></div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
    <script src="/utils/sw-manager.js"></script>
</body>
</html>